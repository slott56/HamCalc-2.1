<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>hamcalc.navigation.solar &mdash; HamCalc 2.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="HamCalc 2.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
        <div class="headertitle"><a
          href="../../../index.html">HamCalc 2.1 documentation</a></div>
        <div class="rel">
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for hamcalc.navigation.solar</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;hamcalc.navigation.solar -- Sunrise, Transit and Sunset.</span>

<span class="sd">See &quot;Sunrise Equation&quot; in Wikipedia. http://en.wikipedia.org/wiki/Sunrise_equation</span>

<span class="sd">This is the calculation of the Julian Astronomical Dates</span>
<span class="sd">of the transit, rise and set of the sun at a given latitude</span>
<span class="sd">and longitude near a given date.</span>

<span class="sd">Julian Astronomical Dates</span>
<span class="sd">--------------------------</span>

<span class="sd">Julian astronomical day calculations from Dershowitz and Reingold.</span>
<span class="sd">This is Herschel and Scaliger julian astronomical day calendar.</span>

<span class="sd">See http://en.wikipedia.org/wiki/Julian_day</span>

<span class="sd">See Dershowitz, Nachum and Edward M. Reingold.  *Calendrical Calculations*. Cambridge University Press. 1997.</span>

<span class="sd">http://emr.cs.uiuc.edu/home/reingold/calendar-book/index.html</span>

<span class="sd">Python&#39;s :mod:`datetime` module uses The Reingold-Dershowitz *rata die*</span>
<span class="sd">system.</span>

<span class="sd">http://en.wikipedia.org/wiki/Rata_Die</span>

<span class="sd">The conversion to Julian Astronomical Dates is ``-1721424.5``,</span>
<span class="sd">the :data:`JAD_epoch` defined in this module.</span>

<span class="sd">Local Time and North American TimeZones</span>
<span class="sd">-----------------------------------------</span>

<span class="sd">The sunrise and sunset times are in UTC.  Localtime offsets need to be applied,</span>
<span class="sd">based on local knowledge of timezones and Daylight Savings Time</span>
<span class="sd">to get to proper local times.</span>

<span class="sd">For this, timezones are imported from the</span>
<span class="sd">:mod:`hamcalc.navigation.solar.timezone` module.</span>

<span class="sd">It&#39;s quite easy to add timezones to cover other historical periods or</span>
<span class="sd">other places on earth.</span>

<span class="sd">Test Case</span>
<span class="sd">----------</span>

<span class="sd">&gt;&gt;&gt; import hamcalc.navigation.solar as solar</span>
<span class="sd">&gt;&gt;&gt; import datetime</span>
<span class="sd">&gt;&gt;&gt; today= datetime.datetime( 2013, 5, 13, tzinfo=solar.Eastern )</span>
<span class="sd">&gt;&gt;&gt; rise, transit, set = solar.rise_transit_set( 38.98, -76.47, today )</span>
<span class="sd">&gt;&gt;&gt; rise.isoformat()</span>
<span class="sd">&#39;2013-05-13T05:55:00.457654-04:00&#39;</span>
<span class="sd">&gt;&gt;&gt; transit.isoformat()</span>
<span class="sd">&#39;2013-05-13T13:02:13.475578-04:00&#39;</span>
<span class="sd">&gt;&gt;&gt; set.isoformat()</span>
<span class="sd">&#39;2013-05-13T20:09:26.493502-04:00&#39;</span>
<span class="sd">&gt;&gt;&gt; rise.astimezone(solar.Eastern).isoformat()</span>
<span class="sd">&#39;2013-05-13T05:55:00.457654-04:00&#39;</span>
<span class="sd">&gt;&gt;&gt; set.astimezone(solar.Eastern).isoformat()</span>
<span class="sd">&#39;2013-05-13T20:09:26.493502-04:00&#39;</span>

<span class="sd">&gt;&gt;&gt; solar.azimuth_elevation( 38.98, -76.47, transit )</span>
<span class="sd">(179.99635135849053, 69.56582340941506)</span>
<span class="sd">&gt;&gt;&gt; solar.azimuth_elevation( 38.98, -76.47, rise )</span>
<span class="sd">(65.23706511941509, -0.7937072477381264)</span>
<span class="sd">&gt;&gt;&gt; solar.azimuth_elevation( 38.98, -76.47, set )</span>
<span class="sd">(294.86842169825667, -0.6953559721037266)</span>

<span class="sd">From other apps and web sites:</span>

<span class="sd">    At 13:00, Azimuth is 178.4, Elevation is 69.6</span>

<span class="sd">    Sunrise azimuth is 65.06, when measured from N.</span>

<span class="sd">    Sunset azimuth is 294.62, when measured from N.</span>

<span class="sd">    The center is 179.84 when measured from N (-0.16 from S).</span>

<span class="sd">Other Horizons; e.g., Nautical Twilight or Astronomical Twilight.</span>

<span class="sd">&gt;&gt;&gt; rise, transit, set = solar.rise_transit_set( 38.98, -76.47, today, horizon=90+12 ) # Nautical</span>
<span class="sd">&gt;&gt;&gt; rise.isoformat()</span>
<span class="sd">&#39;2013-05-13T04:48:24.304646-04:00&#39;</span>
<span class="sd">&gt;&gt;&gt; set.isoformat()</span>
<span class="sd">&#39;2013-05-13T21:16:02.646510-04:00&#39;</span>

<span class="sd">From the USNO web page, the following two official times are given</span>
<span class="sd">for nautical twilight on May 13, 2013: 03:48 20:17</span>

<span class="sd">Calculation Details</span>
<span class="sd">---------------------</span>

<span class="sd">http://www.esrl.noaa.gov/gmd/grad/solcalc/calcdetails.html</span>

<span class="sd">Inputs::</span>

<span class="sd">    phi_o=38.98 # Latitude</span>
<span class="sd">    lambda_o=-76.47 # Longitude</span>
<span class="sd">    z_o=-4 # Timezone offset</span>
<span class="sd">    date = datetime.datetime( 2013, 5, 1, 0, 6, 0)</span>

<span class="sd">Row from the spreadsheet. Columns A through AH (skipping H).</span>

<span class="sd">::</span>

<span class="sd">    D           E       F           G               I       J       K</span>
<span class="sd">    5/1/2013	0:06:00	2456413.67	0.13329694		39.26	5156.09	0.02</span>

<span class="sd">    L   M       N       O       P       Q       R       S       T</span>
<span class="sd">    1.7	40.96	5157.8	1.01	40.96	23.44	23.44	38.54	15.11</span>

<span class="sd">    U       V       W       X           Y       Z           AA      AB</span>
<span class="sd">    0.04	2.88	103.76	13:03:00	6:07:57	19:58:03	830.1	1383</span>

<span class="sd">    AC      AD      AE      AF      AG      AH</span>
<span class="sd">    165.75	124.29	-34.29	0.01	-34.28	343.29</span>

<span class="sd">Output from this test case.</span>

<span class="sd">&gt;&gt;&gt; from hamcalc.navigation.solar import Position_Sun, Eastern</span>
<span class="sd">&gt;&gt;&gt; import datetime</span>
<span class="sd">&gt;&gt;&gt; phi_o=38.98 # Latitude</span>
<span class="sd">&gt;&gt;&gt; lambda_o=-76.47 # Longitude</span>
<span class="sd">&gt;&gt;&gt; z_o=-4 # Timezone offset</span>
<span class="sd">&gt;&gt;&gt; date = datetime.datetime( 2013, 5, 1, 0, 6, 0, tzinfo=Eastern )</span>
<span class="sd">&gt;&gt;&gt; s= Position_Sun( phi_o, lambda_o, date )</span>
<span class="sd">&gt;&gt;&gt; round(s.E,6)</span>
<span class="sd">0.004167</span>
<span class="sd">&gt;&gt;&gt; round(s.F,2)</span>
<span class="sd">2456413.67</span>
<span class="sd">&gt;&gt;&gt; round(s.G,8)</span>
<span class="sd">0.13329694</span>
<span class="sd">&gt;&gt;&gt; round(s.I,2)</span>
<span class="sd">39.26</span>
<span class="sd">&gt;&gt;&gt; round(s.J,2)</span>
<span class="sd">5156.09</span>
<span class="sd">&gt;&gt;&gt; round(s.K,2)</span>
<span class="sd">0.02</span>
<span class="sd">&gt;&gt;&gt; round(s.L,1)</span>
<span class="sd">1.7</span>
<span class="sd">&gt;&gt;&gt; round(s.M,2)</span>
<span class="sd">40.96</span>
<span class="sd">&gt;&gt;&gt; round(s.N,1)</span>
<span class="sd">5157.8</span>
<span class="sd">&gt;&gt;&gt; round(s.O,2)</span>
<span class="sd">1.01</span>
<span class="sd">&gt;&gt;&gt; round(s.P,2)</span>
<span class="sd">40.96</span>
<span class="sd">&gt;&gt;&gt; round(s.Q,2)</span>
<span class="sd">23.44</span>
<span class="sd">&gt;&gt;&gt; round(s.R,2)</span>
<span class="sd">23.44</span>
<span class="sd">&gt;&gt;&gt; round(s.S,2)</span>
<span class="sd">38.53</span>
<span class="sd">&gt;&gt;&gt; round(s.T,2)</span>
<span class="sd">15.11</span>
<span class="sd">&gt;&gt;&gt; round(s.U,2)</span>
<span class="sd">0.04</span>
<span class="sd">&gt;&gt;&gt; round(s.V,2)</span>
<span class="sd">2.89</span>
<span class="sd">&gt;&gt;&gt; round(s.W,2)</span>
<span class="sd">103.76</span>
<span class="sd">&gt;&gt;&gt; s.X_hms</span>
<span class="sd">&#39;13:02:59.0&#39;</span>
<span class="sd">&gt;&gt;&gt; s.Y_hms</span>
<span class="sd">&#39;06:07:55.0&#39;</span>
<span class="sd">&gt;&gt;&gt; s.Z_hms</span>
<span class="sd">&#39;19:58:03.0&#39;</span>
<span class="sd">&gt;&gt;&gt; round(s.AA,1)</span>
<span class="sd">830.1</span>
<span class="sd">&gt;&gt;&gt; round(s.AB,1)</span>
<span class="sd">1383.0</span>
<span class="sd">&gt;&gt;&gt; round(s.AC,2)</span>
<span class="sd">165.75</span>
<span class="sd">&gt;&gt;&gt; round(s.AD,2)</span>
<span class="sd">124.29</span>
<span class="sd">&gt;&gt;&gt; round(s.AE,2)</span>
<span class="sd">-34.29</span>
<span class="sd">&gt;&gt;&gt; round(s.AF,2)</span>
<span class="sd">0.01</span>
<span class="sd">&gt;&gt;&gt; round(s.AG,2)</span>
<span class="sd">-34.28</span>
<span class="sd">&gt;&gt;&gt; round(s.AH,2)</span>
<span class="sd">343.29</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">hamcalc.lib</span> <span class="kn">import</span> <span class="n">AttrDict</span>
<span class="kn">from</span> <span class="nn">hamcalc.navigation.solar.timezone</span> <span class="kn">import</span> <span class="n">utc</span><span class="p">,</span> <span class="n">Newfoundland</span><span class="p">,</span> <span class="n">Atlantic</span><span class="p">,</span> \
    <span class="n">Eastern</span><span class="p">,</span> <span class="n">Central</span><span class="p">,</span> <span class="n">Mountain</span><span class="p">,</span> <span class="n">Pacific</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">JAD_epoch</span><span class="o">=</span> <span class="o">-</span><span class="mf">1721424.5</span> <span class="c"># Julian Astronomical Date epoch.</span>

<div class="viewcode-block" id="jad_to_datetime"><a class="viewcode-back" href="../../../python/navigation/sunup.html#hamcalc.navigation.solar.jad_to_datetime">[docs]</a><span class="k">def</span> <span class="nf">jad_to_datetime</span><span class="p">(</span> <span class="n">jad</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a Julian Astronomical Date into a datetime</span>
<span class="sd">    object.</span>

<span class="sd">    :param jad: floating point JAD.</span>
<span class="sd">    :returns: :class:`datetime.datetime` object with</span>
<span class="sd">        date, time and UTC timezone.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ordinal</span><span class="o">=</span> <span class="n">jad</span><span class="o">+</span><span class="n">JAD_epoch</span>
    <span class="n">date</span><span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">fromordinal</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">ordinal</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">tm</span><span class="o">=</span> <span class="p">(</span><span class="n">ordinal</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">ordinal</span><span class="p">))</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c"># in seconds</span>
    <span class="n">micro</span><span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">tm</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">tm</span><span class="p">))</span><span class="o">*</span><span class="mi">1000000</span><span class="p">)</span>
    <span class="n">sec</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tm</span> <span class="o">%</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">min</span><span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">tm</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">hr</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tm</span> <span class="o">//</span> <span class="mi">3600</span><span class="p">)</span>
    <span class="n">time</span><span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span> <span class="n">hr</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">micro</span><span class="p">,</span> <span class="n">utc</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span> <span class="n">date</span><span class="p">,</span> <span class="n">time</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="datetime_to_jad"><a class="viewcode-back" href="../../../python/navigation/sunup.html#hamcalc.navigation.solar.datetime_to_jad">[docs]</a><span class="k">def</span> <span class="nf">datetime_to_jad</span><span class="p">(</span> <span class="n">dt</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a datetime into a Julian Astronomical Date.</span>

<span class="sd">    :param dt: :class:`datetime.datetime` object with</span>
<span class="sd">        date, time and UTC timezone.</span>
<span class="sd">    :returns: floating point JAD</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Fractions of a day after midnight</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">E</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">minute</span> <span class="o">+</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">second</span><span class="o">+</span><span class="n">t</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">1000000</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span><span class="o">/</span><span class="mi">24</span>

    <span class="c"># Julian Date for date + time - UTC offset (if defined)</span>
    <span class="n">utc</span><span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">dt</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">()</span><span class="o">/</span><span class="mi">24</span>
    <span class="n">jad</span><span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">toordinal</span><span class="p">()</span><span class="o">-</span><span class="n">JAD_epoch</span><span class="o">+</span><span class="n">E</span><span class="o">-</span><span class="n">utc</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">24</span><span class="o">/</span><span class="mi">60</span><span class="o">/</span><span class="mi">60</span>
    <span class="k">return</span> <span class="n">jad</span>
</div>
<span class="k">def</span> <span class="nf">hours_to_h_m_s</span><span class="p">(</span> <span class="n">h</span> <span class="p">):</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="mi">24</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span>

<div class="viewcode-block" id="Position_Sun"><a class="viewcode-back" href="../../../python/navigation/sunup.html#hamcalc.navigation.solar.Position_Sun">[docs]</a><span class="k">class</span> <span class="nc">Position_Sun</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Here&#39;s the mapping from cryptical spreadsheet names to real names.</span>

<span class="sd">    :E: Time (past local midnight)</span>
<span class="sd">    :F: Julian Day</span>
<span class="sd">    :G: Julian Century</span>
<span class="sd">    :I:	Geom Mean Long Sun (deg)</span>
<span class="sd">    :J:	Geom Mean Anom Sun (deg)</span>
<span class="sd">    :K:	Eccent Earth Orbit</span>
<span class="sd">    :L:	Sun Eq of Ctr</span>
<span class="sd">    :M:	Sun True Long (deg)</span>
<span class="sd">    :N:	Sun True Anom (deg)</span>
<span class="sd">    :O:	Sun Rad Vector (AUs)</span>
<span class="sd">    :P:	Sun App Long (deg)</span>
<span class="sd">    :Q:	Mean Obliq Ecliptic (deg)</span>
<span class="sd">    :R:	Obliq Corr (deg)</span>
<span class="sd">    :S:	Sun Rt Ascen (deg)</span>
<span class="sd">    :T:	Sun Declin (deg)</span>
<span class="sd">    :U:	var y</span>
<span class="sd">    :V:	Eq of Time (minutes)</span>
<span class="sd">    :W:	HA Sunrise (deg)</span>
<span class="sd">    :X:	Solar Noon (LST)</span>
<span class="sd">    :Y:	Sunrise Time (LST)</span>
<span class="sd">    :Z:	Sunset Time (LST)</span>
<span class="sd">    :AA:	Sunlight Duration (minutes)</span>
<span class="sd">    :AB:	True Solar Time (min)</span>
<span class="sd">    :AC:	Hour Angle (deg)</span>
<span class="sd">    :AD:	Solar Zenith Angle (deg)</span>
<span class="sd">    :AE:	Solar Elevation Angle (deg)</span>
<span class="sd">    :AF:	Approx Atmospheric Refraction (deg)</span>
<span class="sd">    :AG:	Solar Elevation corrected for atm refraction (deg)</span>
<span class="sd">    :AH:	Solar Azimuth Angle (deg cw from N)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">JAD_epoch</span><span class="o">=</span> <span class="o">-</span><span class="mf">1721424.5</span> <span class="c"># Julian Astronomical Date epoch.</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">phi_o</span><span class="p">,</span> <span class="n">lambda_o</span><span class="p">,</span> <span class="n">date_time_tz</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="bp">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute position of the sun.</span>

<span class="sd">        :param phi_o:</span>
<span class="sd">            Latitude of observer in degrees.</span>

<span class="sd">        :param lambda_o:</span>
<span class="sd">            Longitude of the observer in degrees.</span>

<span class="sd">        :param date_time_tz:</span>
<span class="sd">            :class:`datetime.datetime` for which the sun&#39;s position is requested.</span>
<span class="sd">            This must include tzinfo for the observer&#39;s timezone.</span>

<span class="sd">        :param horizon:</span>
<span class="sd">            The horizon angle from the zenith. Default is 90.833.</span>
<span class="sd">            Other values can be used.</span>
<span class="sd">            -   Astronomical: 108°; 18° below horizon</span>
<span class="sd">            -   Nautical: 102°; 12° below horizon</span>
<span class="sd">            -   Civil: 96°; 6° below horizon</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">horizon</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">horizon</span><span class="o">=</span><span class="mf">90.833</span>

        <span class="c"># GMT offset of the observer in hours.</span>
        <span class="n">z_o</span><span class="o">=</span> <span class="n">date_time_tz</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">()</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">3600</span>

        <span class="c"># Fractions of a day after midnight</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">date_time_tz</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">hour</span><span class="o">/</span><span class="mi">24</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="n">minute</span><span class="o">/</span><span class="mi">24</span><span class="o">/</span><span class="mi">60</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="n">second</span><span class="o">/</span><span class="mi">24</span><span class="o">/</span><span class="mi">60</span><span class="o">/</span><span class="mi">60</span>

        <span class="c"># Julian Date for date + time - UTC offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">date_time_tz</span><span class="o">.</span><span class="n">toordinal</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">JAD_epoch</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">-</span><span class="n">z_o</span><span class="o">/</span><span class="mi">24</span>

        <span class="c"># Julian Century</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">-</span><span class="mi">2451545</span><span class="p">)</span><span class="o">/</span><span class="mi">36525</span>

        <span class="c"># Geom Mean Long Sun (deg)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="p">(</span><span class="mf">280.46646</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="mf">36000.76983</span><span class="o">+</span><span class="mf">0.0003032</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">))</span> <span class="o">%</span> <span class="mi">360</span>
        <span class="n">I_r</span><span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>

        <span class="c"># Geom Mean Anom Sun (deg)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J</span> <span class="o">=</span> <span class="mf">357.52911</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="mf">35999.05029</span><span class="o">-</span><span class="mf">0.0001537</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
        <span class="n">J_r</span><span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="p">)</span>

        <span class="c"># Eccent Earth Orbit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="mf">0.016708634</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="mf">0.000042037</span><span class="o">+</span><span class="mf">0.0000001267</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>

        <span class="c"># Sun Eq of Ctr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="p">(</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">J_r</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.914602</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="mf">0.004817</span><span class="o">+</span><span class="mf">0.000014</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">))</span>
         <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">J_r</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">0.019993</span><span class="o">-</span><span class="mf">0.000101</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
         <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">J_r</span><span class="p">)</span><span class="o">*</span><span class="mf">0.000289</span> <span class="p">)</span>

        <span class="c"># Sun True Long (deg)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>
        <span class="n">M_r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="p">)</span>

        <span class="c"># Sun True Anom (deg).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>
        <span class="n">N_r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="p">)</span>

        <span class="c"># Sun Rad Vector (AUs)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">O</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.000001018</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">N_r</span><span class="p">))</span>

        <span class="c"># Sun App Long (deg)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="o">-</span><span class="mf">0.00569</span><span class="o">-</span><span class="mf">0.00478</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">125.04</span><span class="o">-</span><span class="mf">1934.136</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
        <span class="n">P_r</span><span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="p">)</span>

        <span class="c"># Mean Obliq Ecliptic (deg)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="mi">23</span><span class="o">+</span><span class="p">(</span><span class="mi">26</span><span class="o">+</span><span class="p">((</span><span class="mf">21.448</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="mf">46.815</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="mf">0.00059</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="mf">0.001813</span><span class="p">))))</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span>

        <span class="c"># Obliq Corr (deg)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">+</span><span class="mf">0.00256</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">125.04</span><span class="o">-</span><span class="mf">1934.136</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
        <span class="n">R_r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="p">)</span>

        <span class="c"># Sun Rt Ascen (deg)</span>
        <span class="n">S_r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">R_r</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">P_r</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">P_r</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span> <span class="n">S_r</span> <span class="p">)</span>

        <span class="c"># Sun Declin (deg)</span>
        <span class="n">T_r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">R_r</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">P_r</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span> <span class="n">T_r</span> <span class="p">)</span>

        <span class="c"># var y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span> <span class="n">R_r</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span><span class="o">**</span><span class="mi">2</span>

        <span class="c"># Eq of Time (minutes)</span>
        <span class="n">V_r</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">I_r</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">J_r</span><span class="p">)</span>
            <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">J_r</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">I_r</span><span class="p">)</span>
            <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">I_r</span><span class="p">)</span>
            <span class="o">-</span> <span class="mf">1.25</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">J_r</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span> <span class="n">V_r</span> <span class="p">)</span>

        <span class="c"># HA Sunrise (deg)</span>
        <span class="c"># 90.833 is sun just below the horizon.</span>
        <span class="c"># Other values can be used for various definitions of twilight.</span>
        <span class="n">phi_or</span><span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">phi_o</span><span class="p">)</span>

        <span class="c"># Original.</span>
        <span class="n">W_r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span>
            <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">horizon</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_or</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T_r</span><span class="p">))</span>
            <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">phi_or</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">T_r</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span> <span class="n">W_r</span> <span class="p">)</span>

        <span class="c"># Alternate.</span>
    <span class="c">#     W_a= (math.sin(math.radians(90-horizon)) - math.sin(phi_or)*math.sin(T_r)) / (math.cos(phi_or)*math.cos(T_r))</span>
    <span class="c">#     if W_a &gt; 1:</span>
    <span class="c">#         W_r_alt = 0</span>
    <span class="c">#     elif W_a &lt; -1:</span>
    <span class="c">#         W_r_alt = math.pi</span>
    <span class="c">#     else:</span>
    <span class="c">#         W_r_alt = math.acos( W_a )</span>
    <span class="c">#     W = math.degrees( W_r_alt )</span>

        <span class="c"># Solar Noon (LST)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="mi">720</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">lambda_o</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">+</span> <span class="mi">60</span><span class="o">*</span><span class="n">z_o</span><span class="p">)</span><span class="o">/</span><span class="mi">1440</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_s</span> <span class="o">=</span> <span class="n">hours_to_h_m_s</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_hms</span><span class="o">=</span> <span class="s">&quot;{0:02.0f}:{1:02.0f}:{2:04.1f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">hours_to_h_m_s</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">))</span>

        <span class="c"># Sunrise Time (LST)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">/</span><span class="mi">1440</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y_h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y_m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y_s</span> <span class="o">=</span> <span class="n">hours_to_h_m_s</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y_hms</span><span class="o">=</span> <span class="s">&quot;{0:02.0f}:{1:02.0f}:{2:04.1f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">hours_to_h_m_s</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">))</span>

        <span class="c"># Sunset Time (LST)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">/</span><span class="mi">1440</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z_h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z_m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z_s</span> <span class="o">=</span> <span class="n">hours_to_h_m_s</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z_hms</span><span class="o">=</span> <span class="s">&quot;{0:02.0f}:{1:02.0f}:{2:04.1f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">hours_to_h_m_s</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span>

        <span class="c"># Sunlight Duration (minutes)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AA</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span>

        <span class="c"># True Solar Time (min).</span>
        <span class="c"># Requires the time-of-day offset from the Julian date.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AB</span><span class="o">=</span> <span class="p">(</span><span class="mi">1440</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">lambda_o</span> <span class="o">-</span> <span class="mi">60</span><span class="o">*</span><span class="n">z_o</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1440</span>

        <span class="c"># Hour Angle (deg).</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AB</span><span class="o">/</span><span class="mi">4</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AB</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">180</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AB</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">180</span>
        <span class="n">AC_r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AC</span><span class="p">)</span>

        <span class="c"># Solar Zenith Angle (deg).</span>
        <span class="n">AD_r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_or</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T_r</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_or</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T_r</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">AC_r</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AD</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span> <span class="n">AD_r</span> <span class="p">)</span>

        <span class="c"># Solar Elevation Angle (deg).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AE</span> <span class="o">=</span> <span class="mi">90</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">AD</span>
        <span class="n">AE_r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AE</span><span class="p">)</span>

        <span class="c"># Approx Atmospheric Refraction (deg)</span>
        <span class="k">if</span> <span class="mi">85</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">AE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AF</span><span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="mi">5</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">AE</span> <span class="o">&lt;=</span> <span class="mi">85</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AF</span> <span class="o">=</span> <span class="p">(</span><span class="mf">58.1</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">AE_r</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.07</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">AE_r</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mf">0.000086</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">AE_r</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3600</span>
        <span class="k">elif</span> <span class="o">-</span><span class="mf">0.575</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">AE</span> <span class="o">&lt;=</span><span class="mi">5</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AF</span> <span class="o">=</span> <span class="mi">1735</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">AE</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">518.2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">AE</span><span class="o">*</span><span class="p">(</span><span class="mf">103.4</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">AE</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">12.79</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">AE</span><span class="o">*</span><span class="mf">0.711</span><span class="p">)))</span> <span class="o">/</span> <span class="mi">3600</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># AE &lt; -0.575, i.e., just below the horizon.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AF</span> <span class="o">=</span> <span class="o">-</span><span class="mf">20.772</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">AE_r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3600</span>

        <span class="c"># Solar Elevation corrected for atm refraction (deg).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AG</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AE</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">AF</span>

        <span class="c"># Solar Azimuth Angle (deg cw from N)</span>
        <span class="n">AH_a</span><span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_or</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">AD_r</span><span class="p">)</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T_r</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_or</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">AD_r</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">AH_a</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">AH_rstar</span><span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">AH_a</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">AH_rstar</span><span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">AH_rstar</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span> <span class="n">AH_a</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AC</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AH</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">AH_rstar</span><span class="p">)</span> <span class="o">+</span> <span class="mi">180</span> <span class="o">%</span> <span class="mi">360</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AH</span> <span class="o">=</span> <span class="p">(</span><span class="mi">540</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">AH_rstar</span><span class="p">))</span> <span class="o">%</span> <span class="mi">360</span>
</div>
<div class="viewcode-block" id="rise_transit_set"><a class="viewcode-back" href="../../../python/navigation/sunup.html#hamcalc.navigation.solar.rise_transit_set">[docs]</a><span class="k">def</span> <span class="nf">rise_transit_set</span><span class="p">(</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">date_time_tz</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="bp">None</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute rise time, noon transit time and set time for the sun.</span>

<span class="sd">    :param lat:</span>
<span class="sd">        Latitude of observer in degrees.</span>

<span class="sd">    :param lon:</span>
<span class="sd">        Longitude of the observer in degrees.</span>

<span class="sd">    :param date_time_tz:</span>
<span class="sd">        :class:`datetime.datetime` for which the sun&#39;s position is requested.</span>
<span class="sd">        This must include tzinfo for the observer&#39;s timezone.</span>

<span class="sd">    :param horizon:</span>
<span class="sd">        The horizon angle from the zenith. Default is 90.833.</span>
<span class="sd">        Other values can be used.</span>
<span class="sd">        -   Astronomical: 108°; 18° below horizon</span>
<span class="sd">        -   Nautical: 102°; 12° below horizon</span>
<span class="sd">        -   Civil: 96°; 6° below horizon</span>

<span class="sd">    :returns: Tuple of :class:`datetime.datetime` objects for rise, noon transit</span>
<span class="sd">        and set. These are timezone aware and will have the same timezone as</span>
<span class="sd">        the input datetime.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">date</span><span class="o">=</span> <span class="n">date_time_tz</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span>
    <span class="n">sun</span><span class="o">=</span> <span class="n">Position_Sun</span><span class="p">(</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">horizon</span> <span class="p">)</span>

    <span class="n">transit</span><span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span> <span class="n">days</span><span class="o">=</span><span class="n">sun</span><span class="o">.</span><span class="n">X</span> <span class="p">)</span>
    <span class="n">rise</span><span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span> <span class="n">days</span><span class="o">=</span><span class="n">sun</span><span class="o">.</span><span class="n">Y</span> <span class="p">)</span>
    <span class="nb">set</span><span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span> <span class="n">days</span><span class="o">=</span><span class="n">sun</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">rise</span><span class="p">,</span> <span class="n">transit</span><span class="p">,</span> <span class="nb">set</span>
</div>
<div class="viewcode-block" id="azimuth_elevation"><a class="viewcode-back" href="../../../python/navigation/sunup.html#hamcalc.navigation.solar.azimuth_elevation">[docs]</a><span class="k">def</span> <span class="nf">azimuth_elevation</span><span class="p">(</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">date_time</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute azimuth and elevation of the sun at a given point in time.</span>

<span class="sd">    :param lat:</span>
<span class="sd">        Latitude of observer in degrees.</span>

<span class="sd">    :param lon:</span>
<span class="sd">        Longitude of the observer in degrees.</span>

<span class="sd">    :param date_time_tz:</span>
<span class="sd">        :class:`datetime.datetime` for which the sun&#39;s position is requested.</span>
<span class="sd">        This must include tzinfo for the observer&#39;s timezone.</span>

<span class="sd">    :returns: Tuple of :class:`datetime.datetime` objects for rise, noon transit</span>
<span class="sd">        and set. These are timezone aware and will have the same timezone as</span>
<span class="sd">        the input datetime.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sun</span><span class="o">=</span> <span class="n">Position_Sun</span><span class="p">(</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">date_time</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">sun</span><span class="o">.</span><span class="n">AH</span><span class="p">,</span> <span class="n">sun</span><span class="o">.</span><span class="n">AE</span></div>
</pre></div>

          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../legacy.html">The HamCalc Legacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python_architecture.html">Python Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../python/index.html">Python Modules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../todo.html">The To Do List</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="../../../search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../../../genindex.html" title="General Index"
             >index</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2013, S.Lott.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>